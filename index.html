<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pettiness Meter</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const TRANSLATIONS = {
          "en-US": {
            "title": "How petty is kk ðŸ¥º?",
            "subtitle": "Share your grievance and let Claude be the judge",
            "inputLabel": "What's bothering you?",
            "inputPlaceholder": "My roommate ate the last slice of pizza I was saving...",
            "exampleLoudBreathing": "Sleep Deprived",
            "exampleDoorHolding": "Door holding",
            "exampleFishMicrowaver": "Fish microwaver",
            "exampleWrongTP": "Jatt issue",
            "grievanceLoudBreathing": "My roommate breathes too loudly",
            "grievanceDoorHolding": "Someone didn't say thank you when I held the door",
            "grievanceFishMicrowaver": "My coworker microwaves fish at lunch",
            "grievanceWrongTP": "They put the toilet paper roll on backwards",
            "errorMessage": "Please enter a grievance to analyze!",
            "analyzeButton": "Measure my pettiness!",
            "analyzingButton": "Analyzing pettiness...",
            "analysisTitle": "Analysis",
            "adviceTitle": "Advice",
            "tryAnotherButton": "Try another grievance",
            "failedAnalysis": "Failed to analyze grievance. Please try again!"
          },
          "es-ES": {
            "title": "Â¿QuÃ© tan mezquino eres?",
            "subtitle": "Comparte tu queja y deja que Claude sea el juez",
            "inputLabel": "Â¿QuÃ© te molesta?",
            "inputPlaceholder": "Mi compaÃ±ero de cuarto se comiÃ³ la Ãºltima rebanada de pizza que estaba guardando...",
            "exampleLoudBreathing": "RespiraciÃ³n fuerte",
            "exampleDoorHolding": "Sujetar puerta",
            "exampleFishMicrowaver": "Pescado en microondas",
            "exampleWrongTP": "Papel higiÃ©nico mal",
            "grievanceLoudBreathing": "Mi compaÃ±ero de cuarto respira muy fuerte",
            "grievanceDoorHolding": "Alguien no dijo gracias cuando le sostuve la puerta",
            "grievanceFishMicrowaver": "Mi compaÃ±ero de trabajo calienta pescado en el microondas en el almuerzo",
            "grievanceWrongTP": "Pusieron el rollo de papel higiÃ©nico al revÃ©s",
            "errorMessage": "Â¡Por favor ingresa una queja para analizar!",
            "analyzeButton": "Â¡Mide mi mezquindad!",
            "analyzingButton": "Analizando mezquindad...",
            "analysisTitle": "AnÃ¡lisis",
            "adviceTitle": "Consejo",
            "tryAnotherButton": "Probar otra queja",
            "failedAnalysis": "Error al analizar la queja. Â¡Por favor intenta de nuevo!"
          }
        };

        const browserLocale = navigator.languages?.[0] || navigator.language || 'en-US';
        const findMatchingLocale = (locale) => {
          if (TRANSLATIONS[locale]) return locale;
          const lang = locale.split('-')[0];
          const match = Object.keys(TRANSLATIONS).find(key => key.startsWith(lang + '-'));
          return match || 'en-US';
        };
        const locale = findMatchingLocale(browserLocale);
        const t = (key) => TRANSLATIONS[locale]?.[key] || TRANSLATIONS['en-US'][key] || key;

        // Simple AlertCircle icon component
        const AlertCircle = ({ className }) => (
          <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        );

        const PettinessMeter = () => {
          const [grievance, setGrievance] = useState('');
          const [loading, setLoading] = useState(false);
          const [result, setResult] = useState(null);
          const [error, setError] = useState('');
          const [displayScore, setDisplayScore] = useState(0);

          const exampleGrievances = [
            { label: t('exampleLoudBreathing'), text: t('grievanceLoudBreathing') },
            { label: t('exampleDoorHolding'), text: t('grievanceDoorHolding') },
            { label: t('exampleFishMicrowaver'), text: t('grievanceFishMicrowaver') },
            { label: t('exampleWrongTP'), text: t('grievanceWrongTP') }
          ];

          const analyzeGrievance = async () => {
            if (!grievance.trim()) {
              setError(t('errorMessage'));
              return;
            }

            setLoading(true);
            setError('');

            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1000,
                  messages: [
                    {
                      role: "user",
                      content: `You are a humorous but fair judge of pettiness. Analyze the following grievance and rate it on a scale from 0 to 100, where:
              - 0-20: Legitimate concern (This is actually serious!)
              - 21-40: Reasonable gripe (Fair enough, that's annoying)
              - 41-60: Getting petty (Okay, but maybe chill a bit?)
              - 61-80: Pretty petty (You might want to let this one go...)
              - 81-100: Peak pettiness (Seriously? Let it go!)

              Grievance: "${grievance}"

              Respond ONLY with a valid JSON object in this exact format:
              {
                "score": [number between 0-100],
                "category": "[one of the category names above]",
                "judgment": "[A funny but not mean 1-2 sentence judgment about their grievance]",
                "advice": "[A humorous but helpful suggestion in 1 sentence]"
              }

              DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.

              Please respond in ${locale} language`
                    }
                  ]
                })
              });

              const apiData = await response.json();
              const text = apiData.content[0].text;
              
              // Clean up the response to extract JSON
              const jsonMatch = text.match(/\{[\s\S]*\}/);
              if (!jsonMatch) {
                throw new Error('No JSON found in response');
              }
              
              const data = JSON.parse(jsonMatch[0]);
              setResult(data);
              
              // Animate the score
              animateScore(data.score);
            } catch (err) {
              setError(t('failedAnalysis'));
              console.error('Error:', err);
            } finally {
              setLoading(false);
            }
          };

          const animateScore = (targetScore) => {
            const duration = 1500;
            const startTime = Date.now();
            const startScore = 0;

            const updateScore = () => {
              const now = Date.now();
              const progress = Math.min((now - startTime) / duration, 1);
              
              const easeOut = 1 - Math.pow(1 - progress, 3);
              const currentScore = Math.round(startScore + (targetScore - startScore) * easeOut);
              
              setDisplayScore(currentScore);
              
              if (progress < 1) {
                requestAnimationFrame(updateScore);
              }
            };
            
            requestAnimationFrame(updateScore);
          };

          const getGaugeFillDasharray = (score) => {
            const arcLength = 220;
            const fillLength = (score / 100) * arcLength;
            return `${fillLength} ${arcLength}`;
          };

          return (
            <div className="min-h-screen p-8" style={{ backgroundColor: '#F4BE72' }}>
              <div className="max-w-2xl mx-auto">
                <h1 className="text-5xl font-bold text-center mb-2" style={{ color: '#45260C' }}>
                  {t('title')}
                </h1>
                <p className="text-center mb-8" style={{ color: '#45260C' }}>
                  {t('subtitle')}
                </p>

                <div className="bg-white rounded-2xl shadow-xl p-8">
                  {/* Gauge Meter */}
                  <div className="flex flex-col items-center mb-8">
                    <div className="relative w-80 h-48 mb-4">
                      <svg viewBox="0 0 200 130" className="w-full h-full">
                        <path
                          d="M 30 100 A 70 70 0 0 1 170 100"
                          fill="none"
                          stroke="#E5E7EB"
                          strokeWidth="20"
                          strokeLinecap="round"
                        />
                        
                        <path
                          d="M 30 100 A 70 70 0 0 1 170 100"
                          fill="none"
                          stroke="#E68600"
                          strokeWidth="20"
                          strokeLinecap="round"
                          strokeDasharray={getGaugeFillDasharray(displayScore)}
                          className="transition-all duration-1500 ease-out"
                        />
                        
                        <text x="28" y="125" textAnchor="middle" className="text-xs font-medium" fill="#45260C">0</text>
                        <text x="100" y="15" textAnchor="middle" className="text-xs font-medium" fill="#45260C">50</text>
                        <text x="172" y="125" textAnchor="middle" className="text-xs font-medium" fill="#45260C">100</text>
                      </svg>
                      
                      <div className="absolute inset-0 flex items-center justify-center">
                        <div className="text-center mt-16">
                          <span className="text-5xl font-bold block" style={{ color: '#E68600' }}>
                            {result ? displayScore : 0}%
                          </span>
                          {result && (
                            <span className="text-sm font-medium mt-1 block" style={{ color: '#E68600' }}>
                              {result.category}
                            </span>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Input Section */}
                  <div className="mb-6">
                    <label className="block text-lg font-semibold mb-3" style={{ color: '#45260C' }}>
                      {t('inputLabel')}
                    </label>
                    
                    {!result ? (
                      <>
                        <textarea
                          value={grievance}
                          onChange={(e) => setGrievance(e.target.value)}
                          placeholder={t('inputPlaceholder')}
                          className="w-full p-4 border-2 border-orange-200 rounded-lg focus:border-orange-500 focus:outline-none resize-none"
                          style={{ borderColor: 'rgba(230, 134, 0, 0.3)' }}
                          rows={4}
                        />
                        
                        <div className="mt-3">
                          <div className="flex flex-wrap gap-2">
                            {exampleGrievances.map((example, index) => (
                              <button
                                key={index}
                                onClick={() => setGrievance(example.text)}
                                className="px-3 py-1 text-sm border rounded-full transition-colors hover:bg-orange-50"
                                style={{ 
                                  borderColor: '#E68600',
                                  color: '#45260C',
                                  backgroundColor: 'white'
                                }}
                              >
                                {example.label}
                              </button>
                            ))}
                          </div>
                        </div>
                        
                        {error && (
                          <div className="mt-3 flex items-center text-red-600">
                            <AlertCircle className="w-5 h-5 mr-2" />
                            <span>{error}</span>
                          </div>
                        )}

                        <button
                          onClick={analyzeGrievance}
                          disabled={loading}
                          className="mt-4 w-full py-4 rounded-lg font-bold text-white transition-all transform hover:scale-105"
                          style={{
                            backgroundColor: loading ? '#F5A854' : '#E68600',
                          }}
                        >
                          {loading ? t('analyzingButton') : t('analyzeButton')}
                        </button>
                      </>
                    ) : (
                      <div className="bg-gray-50 rounded-lg p-4">
                        <p className="italic" style={{ color: '#45260C' }}>"{grievance}"</p>
                      </div>
                    )}
                  </div>

                  {/* Results Section */}
                  {result && (
                    <div className="animate-fadeIn">
                      <div className="border-t border-gray-200 pt-6">
                        <div className="space-y-6">
                          <div>
                            <p className="text-lg font-semibold mb-3" style={{ color: '#45260C' }}>{t('analysisTitle')}</p>
                            <div className="bg-orange-50 rounded-lg p-4">
                              <p style={{ color: '#45260C' }}>
                                {result.judgment}
                              </p>
                            </div>
                          </div>
                          
                          <div>
                            <p className="text-lg font-semibold mb-3" style={{ color: '#45260C' }}>{t('adviceTitle')}</p>
                            <div className="bg-orange-100 rounded-lg p-4">
                              <p style={{ color: '#45260C' }}>
                                {result.advice}
                              </p>
                            </div>
                          </div>
                        </div>

                        <button
                          onClick={() => {
                            setGrievance('');
                            setResult(null);
                            setDisplayScore(0);
                          }}
                          className="mt-6 w-full py-3 border-2 rounded-lg font-semibold transition-colors hover:bg-orange-50"
                          style={{ 
                            borderColor: '#E68600', 
                            color: '#E68600' 
                          }}
                        >
                          {t('tryAnotherButton')}
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              <style>{`
                @keyframes fadeIn {
                  from {
                    opacity: 0;
                    transform: translateY(20px);
                  }
                  to {
                    opacity: 1;
                    transform: translateY(0);
                  }
                }
                
                .animate-fadeIn {
                  animation: fadeIn 0.5s ease-out;
                }
              `}</style>
            </div>
          );
        };

        ReactDOM.render(<PettinessMeter />, document.getElementById('root'));
    </script>
</body>
</html>
